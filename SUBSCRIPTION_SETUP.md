# Настройка системы подписок

## Обзор

Бот теперь поддерживает систему подписок с использованием Telegram Stars. Пользователи могут оплачивать доступ к функциям бота или получать бесплатный доступ через whitelist.

## Настройка для администратора

### 1. Создание файлов конфигурации

Создайте файл `.env` с вашими API ключами:
```bash
# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=ваш_токен_бота

# OpenAI API Configuration
OPENAI_API_KEY=ваш_openai_ключ
```

### 2. Настройка whitelist

Отредактируйте файл `whitelist.txt` и добавьте Telegram ID пользователей, которые должны иметь бесплатный доступ:

```
# Список пользователей с бесплатным доступом
# Добавьте Telegram ID пользователей, по одному на строку
# Комментарии начинающиеся с # игнорируются

123456789
987654321
```

**Как узнать Telegram ID пользователя:**
1. Пользователь должен написать боту `/start`
2. ID появится в логах бота
3. Или используйте бота @userinfobot

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 4. Настройка платежей в Telegram

Для работы с Telegram Stars убедитесь, что ваш бот настроен для приёма платежей:

1. Откройте [@BotFather](https://t.me/BotFather)
2. Выберите вашего бота
3. Перейдите в Bot Settings → Payments
4. Включите Telegram Stars как способ оплаты

## Как это работает для пользователей

### Пользователи из whitelist
- Получают бесплатный доступ ко всем функциям
- Видят сообщение о бесплатном доступе при запуске

### Обычные пользователи
- При попытке использовать бота видят предложение оформить подписку
- Могут оплатить 1 ⭐ за месяц доступа
- После оплаты получают доступ на 30 дней

### Доступные команды
- `/start` - запуск бота и проверка статуса
- `/help` - помощь по использованию
- `/subscribe` - оформление подписки
- `/status` - проверка статуса подписки

## Управление подписками

### Автоматическое управление
- Подписки автоматически проверяются при каждом использовании
- Истёкшие подписки блокируют доступ
- Данные хранятся в файле `subscriptions.json`

### Ручное управление
Вы можете напрямую редактировать файл `subscriptions.json`:

```json
{
  "subscriptions": {
    "123456789": "2025-10-28T15:30:00.000000"
  },
  "metadata": {
    "version": "1.0",
    "last_updated": "2025-09-28T15:30:00.000000",
    "description": "Storage for user subscriptions"
  }
}
```

## Безопасность

### Файлы в .gitignore
Следующие файлы автоматически исключены из коммитов:
- `.env` - содержит секретные ключи
- `subscriptions.json` - содержит данные пользователей

### Логирование
Все платежи и изменения подписок логируются для отслеживания.

## Поддержка

При возникновении проблем проверьте:
1. Правильность настройки токенов в `.env`
2. Настройку платежей в BotFather
3. Логи бота для диагностики ошибок

## Стоимость

- **Подписка:** 1 ⭐ за 30 дней
- **Whitelist:** Бесплатный доступ навсегда
